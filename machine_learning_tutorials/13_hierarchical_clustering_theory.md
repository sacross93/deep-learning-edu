# 계층적 클러스터링 완전 이론 가이드

## 1. 개요 및 핵심 개념

### 계층적 클러스터링의 정의
계층적 클러스터링(Hierarchical Clustering)은 데이터 포인트들을 계층 구조로 조직화하여 클러스터를 형성하는 비지도 학습 알고리즘입니다. K-평균과 달리 클러스터 개수를 미리 지정할 필요가 없으며, 덴드로그램(Dendrogram)이라는 트리 구조를 통해 클러스터링 과정을 시각화할 수 있습니다.

### 핵심 특징
- **계층 구조**: 클러스터들이 트리 형태의 계층을 이룸
- **결정론적**: 동일한 데이터와 파라미터에 대해 항상 같은 결과
- **거리 기반**: 데이터 포인트 간 거리나 유사도를 기반으로 동작
- **덴드로그램**: 클러스터링 과정을 시각적으로 표현

### 주요 용어
- **덴드로그램(Dendrogram)**: 계층적 클러스터링 결과를 나타내는 트리 다이어그램
- **연결 기준(Linkage Criteria)**: 클러스터 간 거리를 계산하는 방법
- **병합 높이(Merge Height)**: 두 클러스터가 병합되는 거리 값

## 2. 동작 원리

### 응집형 클러스터링 (Agglomerative Clustering)
가장 일반적인 계층적 클러스터링 방법으로, 상향식(Bottom-up) 접근을 사용합니다.

**알고리즘 단계:**
1. **초기화**: 각 데이터 포인트를 개별 클러스터로 시작
2. **거리 계산**: 모든 클러스터 쌍 간의 거리를 계산
3. **병합**: 가장 가까운 두 클러스터를 병합
4. **거리 업데이트**: 새로 형성된 클러스터와 다른 클러스터들 간의 거리를 재계산
5. **반복**: 모든 데이터가 하나의 클러스터가 될 때까지 2-4단계 반복

### 분할형 클러스터링 (Divisive Clustering)
하향식(Top-down) 접근을 사용하는 방법입니다.

**알고리즘 단계:**
1. **초기화**: 모든 데이터를 하나의 클러스터로 시작
2. **분할**: 클러스터를 두 개의 하위 클러스터로 분할
3. **반복**: 각 데이터 포인트가 개별 클러스터가 될 때까지 분할 반복

**참고**: 분할형은 계산 복잡도가 높아 실제로는 응집형이 더 널리 사용됩니다.

## 3. 연결 기준 (Linkage Criteria)

클러스터 간 거리를 계산하는 방법에 따라 클러스터링 결과가 달라집니다.

### 3.1 단일 연결 (Single Linkage)
- **정의**: 두 클러스터에서 가장 가까운 점들 간의 거리
- **수식**: d(A,B) = min{d(a,b) : a∈A, b∈B}
- **특징**: 
  - 체인 효과(Chaining Effect) 발생 가능
  - 긴 형태의 클러스터 생성 경향
  - 노이즈에 민감

### 3.2 완전 연결 (Complete Linkage)
- **정의**: 두 클러스터에서 가장 먼 점들 간의 거리
- **수식**: d(A,B) = max{d(a,b) : a∈A, b∈B}
- **특징**:
  - 컴팩트한 구형 클러스터 생성
  - 체인 효과 방지
  - 클러스터 크기가 비슷해지는 경향

### 3.3 평균 연결 (Average Linkage)
- **정의**: 두 클러스터의 모든 점 쌍 간 거리의 평균
- **수식**: d(A,B) = (1/|A||B|) Σ Σ d(a,b)
- **특징**:
  - 단일 연결과 완전 연결의 중간적 성질
  - 균형잡힌 클러스터 형성
  - 계산 비용이 상대적으로 높음

### 3.4 워드 연결 (Ward Linkage)
- **정의**: 두 클러스터를 병합했을 때 증가하는 분산의 양
- **수식**: d(A,B) = √[(|A||B|)/(|A|+|B|)] ||μ_A - μ_B||²
- **특징**:
  - 클러스터 내 분산을 최소화
  - 크기가 비슷한 구형 클러스터 생성
  - 가장 널리 사용되는 방법 중 하나

## 4. 성능 평가 방법

### 4.1 내부 평가 지표

**실루엣 계수 (Silhouette Coefficient)**
- 각 데이터 포인트에 대해 같은 클러스터 내 평균 거리와 가장 가까운 다른 클러스터와의 평균 거리를 비교
- 범위: [-1, 1], 높을수록 좋음

**칼린스키-하라바즈 지수 (Calinski-Harabasz Index)**
- 클러스터 간 분산과 클러스터 내 분산의 비율
- 높을수록 좋음

### 4.2 외부 평가 지표 (정답 레이블이 있는 경우)

**조정된 랜드 지수 (Adjusted Rand Index)**
- 두 클러스터링 결과의 유사성 측정
- 범위: [-1, 1], 1에 가까울수록 좋음

**정규화된 상호정보량 (Normalized Mutual Information)**
- 클러스터링 결과와 실제 레이블 간의 정보 공유 정도
- 범위: [0, 1], 높을수록 좋음

### 4.3 덴드로그램 기반 평가

**코페네틱 상관계수 (Cophenetic Correlation Coefficient)**
- 원본 거리와 덴드로그램에서의 거리 간 상관관계
- 높을수록 덴드로그램이 원본 데이터를 잘 표현

## 5. K-평균과의 비교

### 5.1 유사점
- 둘 다 거리 기반 클러스터링 알고리즘
- 구형(spherical) 클러스터에 적합
- 연속형 데이터에 주로 사용

### 5.2 주요 차이점

| 특성 | 계층적 클러스터링 | K-평균 |
|------|------------------|--------|
| 클러스터 개수 | 사후 결정 | 사전 지정 필요 |
| 결과의 일관성 | 결정론적 | 초기값에 따라 변동 |
| 계산 복잡도 | O(n³) | O(nkt) |
| 시각화 | 덴드로그램 제공 | 산점도만 가능 |
| 클러스터 형태 | 다양한 형태 가능 | 구형 클러스터 선호 |
| 대용량 데이터 | 부적합 | 적합 |

### 5.3 장단점 비교

**계층적 클러스터링의 장점:**
- 클러스터 개수를 미리 정할 필요 없음
- 덴드로그램을 통한 직관적 해석
- 결정론적 결과
- 다양한 연결 기준 선택 가능

**계층적 클러스터링의 단점:**
- 높은 계산 복잡도 (O(n³))
- 대용량 데이터 처리 어려움
- 노이즈와 이상치에 민감
- 한 번 병합된 클러스터는 분리 불가

## 6. 적용 사례 및 한계

### 6.1 적용 분야
- **생물학**: 계통 분류학, 유전자 분석
- **마케팅**: 고객 세분화, 제품 분류
- **사회과학**: 설문조사 데이터 분석
- **이미지 처리**: 이미지 세그멘테이션
- **텍스트 마이닝**: 문서 클러스터링

### 6.2 실제 사용 사례

**생물 종 분류**
- DNA 서열 유사성을 기반으로 종의 계통 관계 파악
- 형태학적 특징을 이용한 분류체계 구축

**고객 세분화**
- 구매 패턴, 인구통계학적 특성을 기반으로 고객 그룹 식별
- 마케팅 전략 수립을 위한 세그먼트 분석

### 6.3 알고리즘의 한계

**계산 복잡도**
- O(n³)의 시간 복잡도로 대용량 데이터 처리 어려움
- 메모리 사용량도 O(n²)로 높음

**클러스터 형태의 제약**
- 구형이 아닌 복잡한 형태의 클러스터 탐지 어려움
- 밀도가 다른 클러스터 처리에 한계

**노이즈 민감성**
- 이상치가 전체 클러스터링 결과에 큰 영향
- 특히 단일 연결에서 체인 효과 발생

### 6.4 사용 시 주의사항

**연결 기준 선택**
- 데이터의 특성과 목적에 맞는 연결 기준 선택 중요
- 여러 방법을 시도해보고 결과 비교 권장

**클러스터 개수 결정**
- 덴드로그램의 큰 높이 차이를 기준으로 결정
- 도메인 지식과 비즈니스 요구사항 고려

**전처리의 중요성**
- 특성 스케일링 필수 (표준화 또는 정규화)
- 이상치 제거 또는 처리 고려

## 7. 덴드로그램 해석 가이드

### 7.1 덴드로그램 구성 요소
- **잎(Leaf)**: 개별 데이터 포인트
- **가지(Branch)**: 클러스터 병합을 나타내는 선
- **높이(Height)**: 병합이 일어나는 거리 값
- **절단선(Cut Line)**: 원하는 클러스터 개수를 결정하는 수평선

### 7.2 해석 방법
- **높이가 낮은 병합**: 유사한 데이터들의 병합
- **높이가 높은 병합**: 서로 다른 그룹들의 병합
- **큰 높이 차이**: 자연스러운 클러스터 경계를 의미

### 7.3 클러스터 개수 결정
- **엘보우 방법**: 높이 증가율이 급격히 변하는 지점
- **시각적 판단**: 덴드로그램에서 명확한 분리가 보이는 지점
- **도메인 지식**: 문제 영역의 특성을 고려한 결정

## 8. 용어 사전

**응집형 클러스터링 (Agglomerative Clustering)**: 개별 데이터 포인트에서 시작하여 점진적으로 병합하는 상향식 접근법

**분할형 클러스터링 (Divisive Clustering)**: 전체 데이터에서 시작하여 점진적으로 분할하는 하향식 접근법

**덴드로그램 (Dendrogram)**: 계층적 클러스터링의 결과를 트리 형태로 시각화한 다이어그램

**연결 기준 (Linkage Criteria)**: 클러스터 간 거리를 계산하는 방법 (단일, 완전, 평균, 워드)

**체인 효과 (Chaining Effect)**: 단일 연결에서 발생하는 현상으로, 긴 체인 형태의 클러스터가 형성되는 것

**코페네틱 거리 (Cophenetic Distance)**: 덴드로그램에서 두 데이터 포인트가 처음 병합되는 높이

**절단 높이 (Cut Height)**: 덴드로그램에서 원하는 클러스터 개수를 얻기 위해 설정하는 높이 값

**병합 기준 (Merge Criterion)**: 어떤 클러스터들을 우선적으로 병합할지 결정하는 기준